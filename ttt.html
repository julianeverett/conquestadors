<!DOCTYPE html>
<html lang="en">
<head>
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
  <meta content="utf-8" http-equiv="encoding">
  <title>Times Tables Tester</title>
  <style>
    body { font-family: Verdana, Arial, Helvetica; background-image: url(snowboarder.jpg) }
    h1 { font-size: 40px; color: #111166 }
    h4 { font-size: 15px }
    input {  padding: 7px; font-size: 12px }
    button p {  padding: 0 5px 0 5px; margin: 8px; font-weight: bold }
    .hide { display: none }
    .show { display: block }
    img {padding: 10px; }
    .info { background: #111166; width: 300px; color: #ffffff; font-size: 18px; padding: 20px}
  </style>
</head>
<body>
  <h1>Rowan's Times Tables Tester</h1>
  <h4>Select your times tables:</h4>
  <input type="checkbox" name="table" value="2" id="table2"><label for="table2">2</label>
  <input type="checkbox" name="table" value="3" id="table3"><label for="table3">3</label>
  <input type="checkbox" name="table" value="4" id="table4"><label for="table4">4</label>
  <input type="checkbox" name="table" value="5" id="table5"><label for="table5">5</label>
  <input type="checkbox" name="table" value="6" id="table6"><label for="table6">6</label>
  <input type="checkbox" name="table" value="7" id="table7"><label for="table7">7</label>
  <input type="checkbox" name="table" value="8" id="table8"><label for="table8">8</label>
  <input type="checkbox" name="table" value="9" id="table9"><label for="table9">9</label>
  <input type="checkbox" name="table" value="10" id="table10"><label for="table10">10</label>
  <input type="checkbox" name="table" value="11" id="table11"><label for="table11">11</label>
  <input type="checkbox" name="table" value="12" id="table12"><label for="table12">12</label>
  <br>
  <h4>Select your mode:</h4>
  <input type="radio" name="mode" value="l" id="model" checked="true"><label for="model">Learner Dude</label>
  <input type="radio" name="mode" value="p" id="modep"><label for="modep">Pro Super-dude</label>
  <br>
  <br>
  <button type="button" id="learn" onclick="learn()"><p>LEARN</p></button>
  <button type="button" id="reset" onclick="reset()"><p>CLEAR</p></button>
  <button type="button" id="go" onclick="go()"><p>GO!!!</p></button>
  <div id="revise" class="hide">
    <h4>Let's Learn!</h4>
    <span id="tables">
    </span>
  </div>
  <div id="test" class="hide">
    <h4 id="question"></h4>
    <input type="text" id="answer">
    <div id="result"></div>
  </div>
  <script type="text/javascript">

    const TIMEOUT_LEARNER = 8000;
    const TIMEOUT_PRO = 5000;
    const TIMEOUT_ANSWER = 3200;
    let TIMEOUT = TIMEOUT_LEARNER;
    let active = false;

    function learn() {
      document.getElementById('revise').className = 'show';
      document.getElementById('test').className = 'hide';
      let html = '';
      const tables = getTables();
      for (let i = 0; i < tables.length; i++) {
        html += '<h5>'+tables[i].toString()+' Times Table</h5>';
        for (let j = 1; j <= 12; j++) {
          html += j.toString()+' x '+tables[i].toString()+' = '+(j * tables[i])+'<br/>';
        }
        html += '<br/>';
      }
      document.getElementById('tables').innerHTML= '<div class="info">'+html+'</div>';
    }

    function reset() {
      active = false;
      document.getElementById('revise').className = 'hide';
      document.getElementById('test').className = 'hide';
      document.getElementById('tables').innerHTML= '<p></p>';
    }

    function go() {
      const tables = getTables();
      if (tables.length > 0) {
        TIMEOUT = document.getElementById("model").checked ? TIMEOUT_LEARNER : TIMEOUT_PRO;
        document.getElementById('revise').className = 'hide';
        document.getElementById('test').className = 'show';
        active = true;
        setQuestion(tables, 1, {correctAnswers: 0, wrongQuestions:[] });
      }
    }

    function setQuestion(tables, qNo, summary) {
     document.getElementById('result').innerHTML='';
     if (active) {
        if (qNo <= 30) {
          const i = Math.floor(tables.length * Math.random());
          const j = Math.ceil(12 * Math.random());
          const question = j.toString()+' x '+tables[i].toString();
          html = qNo.toString()+'. What is '+question+ '?';
          const answer = j * tables[i];
          document.getElementById('answer').className = 'show';
          document.getElementById('question').innerHTML= html;
          document.getElementById('answer').value = '';
          setTimeout(function() { checkAnswer(tables, question, answer, qNo, summary); }, TIMEOUT);
        } else {
          if (summary.correctAnswers > 27) {
            document.getElementById('question').innerHTML= 'Congratulations, you passed!!!! You scored '+summary.correctAnswers.toString()+' out of 30.<br><br><img src="https://media.giphy.com/media/f8Fsf1EVVRslO/giphy.gif">';
          } else {
            document.getElementById('question').innerHTML= 'You scored '+summary.correctAnswers.toString()+' out of 30.';
            document.getElementById('result').innerHTML= '<p>You got the following questions wrong: <br>'+summary.wrongQuestions.join('<br>')+'</p>';
          }
          document.getElementById('answer').className = 'hide';
        }
      }
    }

    function checkAnswer(tables, question, answer, qNo, summary) {
      const suffix = Math.ceil(3 * Math.random()).toString();
      if (parseInt(document.getElementById('answer').value) === answer) {
        summary.correctAnswers++;
        // document.getElementById('result').innerHTML='<h4>Hurray!!!!</h4><img src="right'+suffix+'.jpg"/>';
        document.getElementById('result').innerHTML='<h4>Hurray!!!!</h4><img src="https://media.giphy.com/media/3o7qDVArtXdtl223Ek/giphy.gif"/>';
      } else {
        //document.getElementById('result').innerHTML='<h4><i>Uh oh. The answer was '+answer+'.</i></h4><img src="wrong'+suffix+'.jpg"/>';
        document.getElementById('result').innerHTML='<h4><i>Uh oh. The answer was '+answer+'.</i></h4><img src="https://media.giphy.com/media/3o7WIK06ZsP1otF7na/giphy.gif"/>';
        if (summary.wrongQuestions.indexOf(question) === -1 ) {
          summary.wrongQuestions.push(question);
        }
      };
      setTimeout(function() {
        qNo++;
        setQuestion(tables, qNo, summary);
      }, TIMEOUT_ANSWER);
    }

    function getTables() {
      const checkboxes = document.getElementsByName("table");
      const tables = [];
      for (let i = 0; i < checkboxes.length; i++) {
          if (checkboxes[i].checked) {
            tables.push(checkboxes[i].value);
          }
      }
      return tables;
    }
  </script>
</body>
</htmL